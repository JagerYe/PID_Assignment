<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<title>Nectaria - Free HTML Template by WowThemes.net</title>
	<meta name="description" content="Thoughts, reviews and ideas since 1999." />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="icon" href="/PID_Assignment/views/img/logo.png">
	<link rel="stylesheet" type="text/css" href="/PID_Assignment/views/css/screen.css" />
	<link rel="stylesheet" type="text/css"
		href="https://fonts.googleapis.com/css?family=Roboto:400,300italic,300,400italic,700,700italic|Playfair+Display:400,700,400italic,700italic" />
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="/PID_Assignment/views/css/list.css">
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
		integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
		crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
		integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
		crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
		integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
		crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body class="author-template">
	<div class="site-wrapper">
		<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
			<a class="navbar-brand" href="/PID_Assignment/views/pageFront/index_.html">
				<img src="/PID_Assignment/views/img/logo.png" alt="Fashion Critiques" />
			</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse"
				aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarCollapse">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item active">
						<a class="nav-link" href="/PID_Assignment/views/pageFront/index_.html">首頁<span
								class="sr-only">(current)</span></a>
					</li>
					<li class="nav-item active">
						<a class="nav-link" href="/PID_Assignment/views/pageFront/index_.html">商品列表</a>
					</li>
					<li class="nav-item active">
						<a class="nav-link" href="/PID_Assignment/views/pageFront/order.html">訂單</a>
					</li>
					<li class="nav-item active">
						<a class="nav-link" href="/PID_Assignment/views/pageFront/shoppingCart.html">購物車</a>
					</li>
	
				</ul>
				<span class="socialheader row">
					<div class="col" id="userName">userName</div>
					<div class="col">
						<a id="textLogin" href="/PID_Assignment/views/pageFront/login.html">登入</a>
					</div>
					<div class="col" id="textregistered">
						<a href="/PID_Assignment/views/pageFront/registered.html">註冊</a>
					</div>
	
				</span>
			</div>
		</nav>
		<br><br><br><br><br><br>
		<div class="list">
			<ul>
				<li class="row">
					<div class="col-3">商品圖片</div>
					<div class="col-3">名稱</div>
					<div class="col-3">單價</div>
					<div class="col-2">數量</div>
					<div class="col-1"></div>
				</li>
			</ul>


			<ul id="shoppingCartList">

			</ul>

			<div class="row">
				<div class="col-6"></div>
				<div class="col-5 total" id="total">總價格:</div>
				<div class="col-1"><button id="checkout" name="checkout" type="button"
						class="btn btn-primary">結帳</button></div>
			</div>
		</div>
		<br><br>
		<footer class="site-footer clearfix">
			<a href="#top" id="back-to-top" class="back-top"></a>
			<div class="text-center">
				<a href="index.html">Nectaria Template</a> &copy; 2016<br />
				Free HTML Template by <a href="https://wowthemes.net">WowThemes.net</a>
			</div>
		</footer>
	</div>
</body>
<script type="module" src="/PID_Assignment/views/js/title.js"></script>
<script type="module">
	import { Commodity } from "../js/models/commodity.js";
	import { ShoppingCart } from "../js/models/shoppingCart.js";

	import { CommodityViewModel } from "../js/viewModels/commodityViewModel.js";

	// 假資料-------------------------------------------------------------------------
	var commoditys = [
		new Commodity("11", "abc1", 100, 50, "open", "commodityText", null),
		new Commodity("12", "abc2", 22, 50, "open", "commodityText", null),
		new Commodity("13", "abc3", 70, 70, "open", "commodityText", null),
		new Commodity("14", "abc4", 50, 100, "open", "commodityText", null),
		new Commodity("15", "abc5", 10, 50, "open", "commodityText", null)
	];

	var shoppingCart = [
		new ShoppingCart("11", 3),
		new ShoppingCart("12", 3),
		new ShoppingCart("13", 3),
		new ShoppingCart("14", 3),
		new ShoppingCart("15", 3)
	];
	// 假資料-------------------------------------------------------------------------

	//清除購物車內錯誤資料，及提醒庫存不足
	function checking(index) {
		let commodity = commoditys.find(item => item.commodityID == shoppingCart[index].commodityID);
		let str = "";
		if (commodity === undefined) {
			str = "我不知道您從哪生的東西，系統將會把那一筆資料刪除";
		} else if (commodity.commodityPrice <= 0) {
			str = commodity.commodityName + "的售價有問題，系統將會把那一筆資料刪除";
		} else if (commodity.commodityStatus == "close") {
			str = commodity.commodityName + "已下架，系統將會把那一筆資料刪除";
		} else if (commodity.commodityQuantity <= 0 || commodity.commodityQuantity < shoppingCart[index].buyQuantity) {
			alert((commodity.commodityQuantity <= 0) ?
				commodity.commodityName + "目前沒有庫存" : "目前" + commodity.commodityName + "的庫存數量不足，系統會將數量調整為目前庫存量");
			shoppingCart[index].buyQuantity = commodity.commodityQuantity;
		}

		if (str.length > 0) {
			alert(str);
			shoppingCart.splice(index, 1);
			return false;
		}

		return commodity;
	}

	//更新畫面
	function updateMenu() {
		let total = 0;
		$("#shoppingCartList").html("");
		for (let i = 0; i < shoppingCart.length; i++) {
			let commodity = checking(i);
			if (!(commodity)) {
				i--;
				continue;
			}

			$("#shoppingCartList")
				.append(CommodityViewModel.getShoppingCartView(commodity.commodityName,
					commodity.commodityPrice, commodity.commodityQuantity, shoppingCart[i].buyQuantity));
		}
		$(".commodityDelete").click(function () {
			shoppingCart.splice($(this).closest("li").index(), 1);
			updateMenu();
		});
		$(".commodityQuantity").change(function () {
			shoppingCart[$(this).closest("li").index()].buyQuantity = $(this).val();
			$("#total").text("總價格:呼叫伺服");
		});


		$("#total").text("總價格:呼叫伺服");
	}



	$(window).ready(() => {
		//結帳事件
		$("#checkout").click(() => {
			alert("呼叫Sesson的total");
		});

		updateMenu();
	});
</script>

</html>